# -*- coding: utf-8 -*-
import requests
accessKey="8caddd5ad72d86c509982ca2a3229f426883386b0780c114d275fdd8d5829c97"
secretKey="a53754e51fa487075a67832f885a3953cc3854620da3b8212ab3acfcf50901c5"
xapikeys="accessKey="+accessKey+"; secretKey="+secretKey+";"
header={"X-ApiKeys":xapikeys}
url="https://127.0.0.1:8834/scans"
sonuc= requests.get(url=url,headers=header,verify=False)
for i in sonuc.json()['scans']:
	print i
	if "Tarama" in str(i['name']):
		#print "Host Discovery taramas覺 yap覺ld覺."
		#print "id:",i['id']
		#print "uuid:",i['uuid']
		url="https://127.0.0.1:8834/scans/"+str(i['id'])
		sonuc= requests.get(url=url,headers=header,verify=False)
		for j in sonuc.json()['hosts']:
			#print j
			#print j['hostname']
			dosya_adi=str(i['name'])+"_ipler.txt"
			veri=str(j['hostname'])+"\n"
			dosya=open(dosya_adi,"a")
			dosya.write(veri)
			dosya.close()
			url="https://127.0.0.1:8834/scans/"+str(i['id'])+"/hosts/"+str(j['host_id'])
			IP_sonuc= requests.get(url=url,headers=header,verify=False)
			for k in IP_sonuc.json()['vulnerabilities']:
				plugin_id=k['plugin_id'] 
				url="https://127.0.0.1:8834/plugins/plugin/"+str(plugin_id)
				plugin_sonuc= requests.get(url=url,headers=header,verify=False)
				for plugin in plugin_sonuc.json()['attributes']:
					if "exploit_framework_metasploit" in plugin['attribute_name']:
						print "Exploit edilebilir plugin"
						print "IP:",str(j['hostname'])
						print "Plugin id:",plugin_id
						print "Plugin ad覺:",k['plugin_name']
						print "="*30 
			#if IP_sonuc.json()['vulnerabilities']['plugin_id'] == "11936":
			#	print str(IP_sonuc.json()['info']['operating-system']),"-",str(j['hostname'])
			#if IP_sonuc.json()['{u'info': {u'control': True, u'migrated': 0, u'license_info': {u'trimmed': None, u'limit': 32}, u'severity_processed': u'202111241406', u'edit_allowed': True, u'exploitable_vulns': True, u'hasaudittrail': True, u'current_severity_base': u'cvss_v3', u'user_permissions': 128, u'alt_targets_used': False, u'targets': u'10.10.10.0/24', u'uuid': u'9124b1b7-d1d1-b878-6a42-bf2a8fd463cbbd5bf9345ea35328', u'hostcount': 4, u'top10': True, u'scan_group': None, u'object_id': 16, u'acls': [{u'display_name': None, u'name': None, u'owner': None, u'type': u'default', u'id': None, u'permissions': 0}, {u'display_name': u'siber', u'name': u'siber', u'owner': 1, u'type': u'user', u'id': 2, u'permissions': 128}], u'policy_template_uuid': u'bbd4f805-3966-d464-b2d1-0079eb89d69708c3a05ec2812bcf', u'policy': u'Host Discovery', u'offline': False, u'hosts_vulns': True, u'scanner_name': u'Local Scanner', u'scan_end': 1637836071, u'selected_severity_base': u'system_default', u'status': u'completed', u'oses_found': True, u'scanner_end': 1637836068, u'node_host': None, u'timestamp': 1637836071, u'scan_type': u'local', u'unsupported_software': True, u'scan_start': 1637835857, u'folder_id': 3, u'current_severity_base_display': u'CVSS v3.0', u'no_target': False, u'node_id': None, u'year_old_vulns': True, u'name': u'Host Discovery', u'severity_base_selections': [{u'display': u'CVSS v2.0', u'value': u'cvss_v2'}, {u'display': u'CVSS v3.0', u'value': u'cvss_v3'}, {u'display': u'Default (CVSS v3.0)', u'value': u'system_default'}], u'haskb': True, u'node_name': None, u'pci-can-upload': False, u'known_accounts': True, u'scanner_start': 1637835857}, u'remediations': {u'num_cves': 0, u'num_remediated_cves': 0, u'num_impacted_hosts': 0, u'num_hosts': 3, u'remediations': None}, u'vulnerabilities': [{u'count': 2, u'severity': 0, u'plugin_family': u'General', u'cpe': None, u'plugin_name': u'OS Identification', u'severity_index': 0, u'score': None, u'vuln_index': 4, u'snoozed': 0, u'plugin_id': 11936, u'offline': False}, {u'count': 3, u'severity': 0, u'plugin_family': u'Port scanners', u'cpe': None, u'plugin_name': u'Ping the remote host', u'severity_index': 1, u'score': None, u'vuln_index': 5, u'snoozed': 0, u'plugin_id': 10180, u'offline': False}, {u'count': 3, u'severity': 0, u'plugin_family': u'Settings', u'cpe': None, u'plugin_name': u'Nessus Scan Information', u'severity_index': 2, u'score': None, u'vuln_index': 3, u'snoozed': 0, u'plugin_id': 19506, u'offline': False}], u'notes': None, u'compliance': [], u'prioritization': {u'threat_level': 0, u'plugins': []}, u'hosts': [{u'offline_high': 0, u'high': 0, u'scanprogresscurrent': 100, u'offline_critical': 0, u'scanprogresstotal': 100, u'totalchecksconsidered': 418, u'low': 0, u'offline_medium': 0, u'hostname': u'10.10.10.2', u'numchecksconsidered': 418, u'severity': 2, u'offline_info': 0, u'score': 2, u'info': 2, u'host_index': 0, u'host_id': 3, u'severitycount': {u'item': [{u'count': 2, u'severitylevel': 0}, {u'count': 0, u'severitylevel': 1}, {u'count': 0, u'severitylevel': 2}, {u'count': 0, u'severitylevel': 3}, {u'count': 0, u'severitylevel': 4}, {u'count': 0, u'severitylevel': 5}, {u'count': 0, u'severitylevel': 6}, {u'count': 0, u'severitylevel': 7}, {u'count': 0, u'severitylevel': 8}, {u'count': 0, u'severitylevel': 9}]}, u'progress': u'100-100/418-418', u'medium': 0, u'critical': 0, u'offline_low': 0}, {u'offline_high': 0, u'high': 0, u'scanprogresscurrent': 100, u'offline_critical': 0, u'scanprogresstotal': 100, u'totalchecksconsidered': 418, u'low': 0, u'offline_medium': 0, u'hostname': u'10.10.10.10', u'numchecksconsidered': 418, u'severity': 3, u'offline_info': 0, u'score': 3, u'info': 3, u'host_index': 1, u'host_id': 11, u'severitycount': {u'item': [{u'count': 3, u'severitylevel': 0}, {u'count': 0, u'severitylevel': 1}, {u'count': 0, u'severitylevel': 2}, {u'count': 0, u'severitylevel': 3}, {u'count': 0, u'severitylevel': 4}, {u'count': 0, u'severitylevel': 5}, {u'count': 0, u'severitylevel': 6}, {u'count': 0, u'severitylevel': 7}, {u'count': 0, u'severitylevel': 8}, {u'count': 0, u'severitylevel': 9}]}, u'progress': u'100-100/418-418', u'medium': 0, u'critical': 0, u'offline_low': 0}, {u'offline_high': 0, u'high': 0, u'scanprogresscurrent': 100, u'offline_critical': 0, u'scanprogresstotal': 100, u'totalchecksconsidered': 418, u'low': 0, u'offline_medium': 0, u'hostname': u'10.10.10.20', u'numchecksconsidered': 418, u'severity': 3, u'offline_info': 0, u'score': 3, u'info': 3, u'host_index': 2, u'host_id': 21, u'severitycount': {u'item': [{u'count': 3, u'severitylevel': 0}, {u'count': 0, u'severitylevel': 1}, {u'count': 0, u'severitylevel': 2}, {u'count': 0, u'severitylevel': 3}, {u'count': 0, u'severitylevel': 4}, {u'count': 0, u'severitylevel': 5}, {u'count': 0, u'severitylevel': 6}, {u'count': 0, u'severitylevel': 7}, {u'count': 0, u'severitylevel': 8}, {u'count': 0, u'severitylevel': 9}]}, u'progress': u'100-100/418-418', u'medium': 0, u'critical': 0, u'offline_low': 0}], u'filters': [{u'control': {u'list': [u'true', u'false'], u'prefix': u'filter', u'type': u'dropdown'}, u'operators': [u'eq', u'neq'], u'readable_name': u'Asset Inventory', u'name': u'asset_inventory'}, {u'control': {u'regex': u'.*', u'readable_regex': u'TEXT', u'type': u'entry', u'prefix': u'filter'}, u'operators': [u'eq', u'neq', u'match', u'nmatch'], u'readable_name': u'Hostname', u'name': u'hostname'}, {u'control': {u'regex': u'.*', u'readable_regex': u'TEXT', u'type': u'entry', u'prefix': u'filter'}, u'operators': [u'match', u'nmatch'], u'readable_name': u'Plugin Description', u'name': u'description'}, {u'control': {u'list': [u'AIX Local Security Checks', u'Amazon Linux Local Security Checks', u'Backdoors', u'Brute force attacks', u'CGI abuses', u'CGI abuses : XSS', u'CISCO', u'CentOS Local Security Checks', u'DNS', u'Databases', u'Debian Local Security Checks', u'Default Unix Accounts', u'Denial of Service', u'F5 Networks Local Security Checks', u'FTP', u'Fedora Local Security Checks', u'Firewalls', u'FreeBSD Local Security Checks', u'Gain a shell remotely', u'General', u'Gentoo Local Security Checks', u'HP-UX Local Security Checks', u'Huawei Local Security Checks', u'Junos Local Security Checks', u'MacOS X Local Security Checks', u'Mandriva Local Security Checks', u'Misc.', u'Mobile Devices', u'Netware', u'NewStart CGSL Local Security Checks', u'Oracle Linux Local Security Checks', u'OracleVM Local Security Checks', u'Palo Alto Local Security Checks', u'Peer-To-Peer File Sharing', u'PhotonOS Local Security Checks', u'Policy Compliance', u'Port scanners', u'RPC', u'Red Hat Local Security Checks', u'SCADA', u'SMTP problems', u'SNMP', u'Scientific Linux Local Security Checks', u'Service detection', u'Settings', u'Slackware Local Security Checks', u'Solaris Local Security Checks', u'SuSE Local Security Checks', u'Ubuntu Local Security Checks', u'VMware ESX Local Security Checks', u'Virtuozzo Local Security Checks', u'Web Servers', u'Windows', u'Windows : Microsoft Bulletins', u'Windows : User management'], u'prefix': u'filter', u'type': u'dropdown'}, u'operators': [u'eq', u'neq'], u'readable_name': u'Plugin Family', u'name': u'plugin_family'}, {u'control': {u'regex': u'^[0-9, ]+$', u'readable_regex': u'NUMBER', u'type': u'entry', u'prefix': u'filter'}, u'operators': [u'eq', u'neq', u'match', u'nmatch'], u'readable_name': u'Plugin ID', u'name': u'plugin_id'}, {u'control': {u'regex': u'^[0-9]{4}-[0-9]{2}-[0-9]{2}$', u'readable_regex': u'YYYY-MM-DD', u'type': u'datefield', u'prefix': u'filter'}, u'operators': [u'date-lt', u'date-gt', u'date-eq', u'date-neq', u'match', u'nmatch'], u'readable_name': u'Plugin Modification Date', u'name': u'plugin_modification_date'}, {u'control': {u'regex': u'.*', u'readable_regex': u'TEXT', u'type': u'entry', u'prefix': u'filter'}, u'operators': [u'eq', u'neq', u'match', u'nmatch'], u'readable_name': u'Plugin Name', u'name': u'plugin_name'}, {u'control': {u'regex': u'.*', u'readable_regex': u'TEXT', u'type': u'entry', u'prefix': u'filter'}, u'operators': [u'eq', u'neq', u'match', u'nmatch'], u'readable_name': u'Plugin Output', u'name': u'plugin_output'}, {u'control': {u'regex': u'^[0-9]{4}-[0-9]{2}-[0-9]{2}$', u'readable_regex': u'YYYY-MM-DD', u'type': u'datefield', u'prefix': u'filter'}, u'operators': [u'date-lt', u'date-gt', u'date-eq', u'date-neq', u'match', u'nmatch'], u'readable_name': u'Plugin Publication Date', u'name': u'plugin_publication_date'}, {u'control': {u'list': [u'local', u'remote'], u'prefix': u'filter', u'type': u'dropdown'}, u'operators': [u'eq', u'neq'], u'readable_name': u'Plugin Type', u'name': u'plugin_type'}, {u'control': {u'regex': u'^[0-9]+$', u'readable_regex': u'80', u'type': u'entry', u'prefix': u'filter'}, u'operators': [u'eq', u'neq', u'match', u'nmatch'], u're
